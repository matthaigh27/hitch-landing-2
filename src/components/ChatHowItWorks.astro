---
const steps = [
    {
        number: "01",
        icon: "⌀",
        title: "Branch any message",
        description:
            "Fork a conversation into its own space without derailing what's happening. The original thread stays clean; the branch has its own focus.",
        code: '> branch "test plan"',
    },
    {
        number: "02",
        icon: "⬡",
        title: "AI captures every action",
        description:
            "Every decision, task, and commitment in your conversations is automatically extracted and tracked. Not something you remember to summarize.",
        code: "✓ ship by Thursday",
    },
    {
        number: "03",
        icon: "◎",
        title: "Signals, not notifications",
        description:
            "You're only interrupted when something genuinely needs you - not when someone reacts to a meme, or a thread you were cc'd on moves.",
        code: "⬡ 3 signals · 0 noise",
    },
];
---

<section class="chat-hiw" id="chat-how-it-works">
    <div class="chat-hiw__inner">
        <header class="chat-hiw__header">
            <p class="chat-hiw__eyebrow">How it works</p>
            <h2 class="chat-hiw__heading">
                Three things chat should have done<br /><em>from the start.</em>
            </h2>
        </header>

        <div class="chat-hiw__grid" id="chat-hiw-grid">
            {
                steps.map((step, i) => (
                    <>
                        <div class="chat-hiw__card">
                            <div
                                class="chat-hiw__card-number"
                                aria-hidden="true"
                            >
                                {step.number}
                            </div>
                            <div class="chat-hiw__card-icon" aria-hidden="true">
                                {step.icon}
                            </div>
                            <h3 class="chat-hiw__card-title">{step.title}</h3>
                            <p class="chat-hiw__card-desc">
                                {step.description}
                            </p>
                            <code class="chat-hiw__card-code">{step.code}</code>
                        </div>
                        {i < steps.length - 1 && (
                            <div class="chat-hiw__connector" aria-hidden="true">
                                <span class="chat-hiw__connector-line" />
                                <span class="chat-hiw__connector-arrow">›</span>
                            </div>
                        )}
                    </>
                ))
            }
        </div>
    </div>
</section>

<script>
    const section = document.getElementById("chat-hiw-grid");

    const observer = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.classList.add("is-active");
                    observer.unobserve(entry.target);
                }
            });
        },
        { threshold: 0.2 },
    );

    if (section) observer.observe(section);
</script>

<style>
    .chat-hiw {
        padding: 7rem var(--gutter);
        border-top: 1px solid var(--divider);
    }

    .chat-hiw__inner {
        max-width: var(--max-w);
        margin: 0 auto;
    }

    .chat-hiw__header {
        margin-bottom: 4rem;
    }

    .chat-hiw__eyebrow {
        font-family: var(--font-mono);
        font-size: var(--text-xs);
        color: var(--text-muted);
        letter-spacing: 0.12em;
        text-transform: uppercase;
        margin-bottom: 1rem;
    }

    .chat-hiw__heading {
        font-family: var(--font-display);
        font-size: var(--text-3xl);
        font-weight: 400;
        line-height: 1.12;
        letter-spacing: -0.02em;
    }

    .chat-hiw__heading em {
        font-style: italic;
        color: var(--accent);
    }

    /* ---- Grid ---- */

    .chat-hiw__grid {
        display: grid;
        grid-template-columns: 1fr auto 1fr auto 1fr;
        gap: 0;
        align-items: start;
    }

    /* ---- Card ---- */

    .chat-hiw__card {
        background: var(--surface);
        border: 1px solid var(--divider);
        border-radius: 8px;
        padding: 2.25rem 2rem;
        position: relative;
        overflow: hidden;
        transition: border-color 0.3s var(--ease-out);
    }

    .chat-hiw__grid.is-active .chat-hiw__card {
        border-color: rgba(var(--accent-rgb), 0.15);
    }

    .chat-hiw__card-number {
        font-family: var(--font-mono);
        font-size: var(--text-stat);
        font-weight: 700;
        color: var(--divider);
        line-height: 1;
        margin-bottom: 1.25rem;
        user-select: none;
        letter-spacing: -0.04em;
    }

    .chat-hiw__card-icon {
        font-size: var(--text-2xl);
        margin-bottom: 1rem;
        line-height: 1;
    }

    .chat-hiw__card-title {
        font-family: var(--font-display);
        font-size: var(--text-xl);
        font-weight: 400;
        margin-bottom: 0.75rem;
        letter-spacing: -0.01em;
    }

    .chat-hiw__card-desc {
        font-size: var(--text-sm);
        color: var(--text-muted);
        line-height: 1.7;
        margin-bottom: 1.5rem;
    }

    .chat-hiw__card-code {
        display: inline-block;
        font-family: var(--font-mono);
        font-size: var(--text-xs);
        color: var(--accent);
        background: rgba(var(--accent-rgb), 0.08);
        padding: 0.25rem 0.6rem;
        border-radius: 4px;
        border: 1px solid rgba(var(--accent-rgb), 0.2);
    }

    /* ---- Connector ---- */

    .chat-hiw__connector {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 0 1.5rem;
        padding-top: calc(
            2.25rem + var(--text-stat) + 1.25rem + var(--text-2xl) + 1rem
        );
        gap: 0.25rem;
        min-width: 60px;
    }

    .chat-hiw__connector-line {
        display: block;
        height: 1px;
        width: 0;
        background: var(--accent);
        transition: width 0.6s var(--ease-out) 0.3s;
    }

    .chat-hiw__grid.is-active .chat-hiw__connector-line {
        width: 100%;
    }

    @media (prefers-reduced-motion: reduce) {
        .chat-hiw__connector-line {
            width: 100%;
            transition: none;
        }

        .chat-hiw__grid.is-active .chat-hiw__card {
            border-color: rgba(var(--accent-rgb), 0.15);
        }
    }

    .chat-hiw__connector-arrow {
        font-size: 1.25rem;
        color: var(--accent);
        line-height: 1;
        margin-top: 0.15rem;
    }

    /* ---- Responsive ---- */

    @media (max-width: 900px) {
        .chat-hiw__grid {
            grid-template-columns: 1fr;
        }

        .chat-hiw__connector {
            flex-direction: row;
            padding: 0.5rem 2rem;
            min-width: auto;
            justify-content: flex-start;
        }

        .chat-hiw__connector-line {
            flex: 1;
            height: 1px;
            width: auto;
        }

        .chat-hiw__grid.is-active .chat-hiw__connector-line {
            width: auto;
        }

        .chat-hiw__connector-arrow {
            transform: rotate(90deg);
        }
    }
</style>
