---
---

<section class="cta" id="waitlist">
  <div class="cta__inner">

    <p class="cta__tagline">Documentation that deploys itself.</p>

    <h2 class="cta__heading">
      Stop writing docs.<br />
      <em>Start shipping them.</em>
    </h2>

    <form
      class="cta__form"
      id="waitlist-form"
      action=""
      method="POST"
      novalidate
    >
      <!--
        FORM WIRING NEEDED:
        Set action="" to your Formspree endpoint, e.g.:
          action="https://formspree.io/f/YOUR_FORM_ID"
        Or point to an Astro API route:
          action="/api/waitlist"
        and create src/pages/api/waitlist.ts
      -->
      <div class="cta__field">
        <label for="email" class="cta__sr-label">Work email address</label>
        <input
          type="email"
          id="email"
          name="email"
          placeholder="you@company.com"
          class="cta__input"
          required
          autocomplete="email"
        />
        <button type="submit" class="cta__submit">
          <span class="cta__submit-text">Join Waitlist</span>
          <span class="cta__submit-icon" aria-hidden="true">→</span>
        </button>
      </div>
      <p class="cta__consent">No spam, ever. Unsubscribe in one click.</p>
    </form>

    <div class="cta__success" id="cta-success" aria-live="polite" aria-atomic="true">
      ✓ You're on the list. We'll be in touch soon.
    </div>

  </div>
</section>

<footer class="site-footer">
  <div class="site-footer__inner">
    <span class="site-footer__logo">HITCH</span>
    <span class="site-footer__copy">
      &copy; {new Date().getFullYear()} Hitch. All rights reserved.
    </span>
    <span class="site-footer__tagline">Documentation that deploys itself.</span>
  </div>
</footer>

<script>
  const form = document.getElementById('waitlist-form') as HTMLFormElement | null;
  const successEl = document.getElementById('cta-success');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const action = form.getAttribute('action');
    const emailInput = form.querySelector<HTMLInputElement>('input[type="email"]');

    if (!emailInput?.value) return;

    // If no action is wired, show success state anyway for demo/dev
    if (!action) {
      showSuccess();
      return;
    }

    try {
      const res = await fetch(action, {
        method: 'POST',
        body: new FormData(form),
        headers: { Accept: 'application/json' },
      });
      if (res.ok) {
        showSuccess();
      } else {
        // Re-enable for retry
        const btn = form.querySelector<HTMLButtonElement>('.cta__submit');
        if (btn) btn.disabled = false;
      }
    } catch {
      // Network error — still show success for graceful degradation
      showSuccess();
    }
  });

  function showSuccess(): void {
    if (!form || !successEl) return;
    form.classList.add('is-submitted');
    // Show element first, then transition in on next paint cycle
    successEl.style.display = 'block';
    requestAnimationFrame(() => requestAnimationFrame(() => successEl.classList.add('is-visible')));
  }
</script>

<style>
  /* ---- CTA section ---- */

  .cta {
    background: #040404;
    padding: 8rem var(--gutter) 7rem;
    border-top: 1px solid var(--divider);
  }

  .cta__inner {
    max-width: 700px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .cta__tagline {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--text-muted);
    letter-spacing: 0.14em;
    text-transform: uppercase;
    margin-bottom: 1.5rem;
  }

  .cta__heading {
    font-family: var(--font-display);
    font-size: var(--text-hero);
    font-weight: 400;
    line-height: 1.05;
    letter-spacing: -0.02em;
    margin-bottom: 3rem;
  }

  .cta__heading em {
    font-style: italic;
    color: var(--accent);
  }

  /* ---- Form ---- */

  .cta__form {
    width: 100%;
    max-width: 560px;
  }

  .cta__form.is-submitted {
    display: none;
  }

  .cta__sr-label {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  .cta__field {
    display: flex;
    align-items: stretch;
    background: var(--surface);
    border: 1px solid var(--divider);
    border-radius: 999px;
    overflow: hidden;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .cta__field:focus-within {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(200, 255, 0, 0.15);
  }

  .cta__input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    padding: 0.9rem 1.5rem;
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    color: var(--text);
    min-width: 0;
  }

  .cta__input::placeholder {
    color: var(--text-muted);
  }

  .cta__submit {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: var(--accent);
    color: var(--bg);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    font-weight: 700;
    padding: 0.9rem 1.5rem;
    letter-spacing: 0.04em;
    transition: background 0.2s;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .cta__submit:hover {
    background: var(--accent-dim);
  }

  .cta__submit:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .cta__consent {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 0.9rem;
    padding-left: 1.5rem;
  }

  /* ---- Success state ---- */

  .cta__success {
    display: none; /* JS sets display:block before adding .is-visible */
    font-family: var(--font-mono);
    font-size: var(--text-lg);
    color: var(--accent);
    padding: 1.5rem 0;
    opacity: 0;
    transform: translateY(8px);
    transition:
      opacity 0.4s var(--ease-out),
      transform 0.4s var(--ease-out);
  }

  .cta__success.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (prefers-reduced-motion: reduce) {
    .cta__success {
      transition: none;
    }
  }

  /* ---- Footer ---- */

  .site-footer {
    background: #040404;
    border-top: 1px solid var(--divider);
    padding: 2rem var(--gutter);
  }

  .site-footer__inner {
    max-width: var(--max-w);
    margin: 0 auto;
    display: flex;
    align-items: center;
    gap: 2rem;
    flex-wrap: wrap;
  }

  .site-footer__logo {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    font-weight: 700;
    letter-spacing: 0.18em;
    color: var(--text);
  }

  .site-footer__copy {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--text-muted);
  }

  .site-footer__tagline {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--divider);
    margin-left: auto;
  }

  @media (max-width: 480px) {
    .cta__field {
      flex-direction: column;
      border-radius: 12px;
    }

    .cta__submit {
      border-radius: 0;
      justify-content: center;
    }

    .site-footer__tagline {
      margin-left: 0;
    }
  }
</style>
